<%- include('header') -%>

    <div class="container">
        <div class="jumbotron">
            <h1>Suppliers</h1>
        </div>
        <a href="add_supplier" class="btn btn-primary btn-lg btn-block" role="button" aria-pressed="true">Add supplier</a>

      <hr />
    </div>
    <div class="container">
        <div class="list-group">
            <div class="panel-group" id="accordion">
                <% var i=0; %>
                    <% suppliers.forEach(function(item) { %>
                        <% i = i+1; %>
                                <div class="row">
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <h4 class="panel-title">
                        <a data-toggle="collapse" href="#collapse<%= i %>"><span class="glyphicon glyphicon-collapse-down"></span>   <%= item['supplier_name']%> </a>
                      </h4>
                                        </div>

                                        <ul class="list-group">
                                            <li class="list-group-item clearfix">
                                                <div class="col-md-4 vcenter">
                                                    <p class="list-group-item-text">
                                                        Contact:
                                                        <%= item["supplier_contact"] %>
                                                    </p>
                                                    <%if (item["products"]) { %>
                                                        <p class="list-group-item-text">
                                                            Number of products:
                                                            <%= item["products"].length %>
                                                        </p>
                                                        <% } else{ %>
                                                            <p class="list-group-item-text">
                                                                Number of products: 0
                                                            </p>
                                                            <% } %>
                                                </div>


                                                <div id="collapse<%= i %>" class="panel-collapse collapse">
                                                    <div class="panel-body">

                                                      <%if (item["products"]) { %>
                                                          <% item["products"].forEach(function(item) { %>

                                                                  <label for="product_name">Product name:</label>
                                                                  <p>
                                                                    <%=item['product_name'] %>
                                                                  </p>
                                                                  <label for="product_price">Product price:</label>
                                                                  <p>
                                                                    <%=item['product_price'] %>
                                                                  </p>
<hr/>


                                                              <% }); %>
                                                     <% } %>
                                                      </div>

                                              </div>

                                                <div class="col-md-4 pull-right vertical-align">

                                                    <p>
                                                    </p>

                                                    <span class="pull-right button-group">
          <a href='add_product/<%= item["_id"] %>' class="btn btn-primary"><span class="glyphicon glyphicon-plus"></span> Add product</a>
                                                    <a href='edit/<%= item["_id"] %>' class="btn btn-warning"><span class="glyphicon glyphicon-edit"></span> Edit</a>

                                                    <button type="button"  data-id=<%=item['_id']%> class="open-deleteDialog btn btn-danger " data-toggle="modal" data-target="#myModal"><span class="glyphicon glyphicon-remove"></span> Delete</button>
                                                    <div class="modal fade" id="myModal" role="dialog">
                                                        <div class="modal-dialog">

                                                            <div class="modal-content">
                                                                <div class="modal-header">
                                                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                                    <h4 class="modal-title">Warning</h4>
                                                                </div>
                                                                <div class="modal-body">
                                                                    <p>Are you sure you want to delete this supplier?</p>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                                                    <a href='' value = '' id="deletelink" name="deletelink"  class="btn btn-danger"><span class="glyphicon glyphicon-remove"></span> Delete</a>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>

                                                </span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
            </div>

            <% }); %>

        </div>
    </div>

<script>

$(document).on("click", ".open-deleteDialog", function () {
     var mySupplierID = $(this).data('id');
     console.log('delete/'+mySupplierID);
     $(".modal-footer #deletelink").attr('href','delete/'+mySupplierID );
});

</script>

    </body>
