<%- include('header') -%>
<style>

.spinner {
  width: 100px;
}
.spinner input {
  text-align: right;
}
.input-group-btn-vertical {
  position: relative;
  white-space: nowrap;
  width: 1%;
  vertical-align: middle;
  display: table-cell;
}
.input-group-btn-vertical > .btn {
  display: block;
  float: none;
  width: 100%;
  max-width: 100%;
  padding: 8px;
  margin-left: -1px;
  position: relative;
  border-radius: 0;
}
.input-group-btn-vertical > .btn:first-child {
  border-top-right-radius: 4px;
}
.input-group-btn-vertical > .btn:last-child {
  margin-top: -2px;
  border-bottom-right-radius: 4px;
}
.input-group-btn-vertical i{
  position: absolute;
  top: 0;
  left: 4px;
}
</style>
    <div class="container">
        <div class="jumbotron">
            <h1>Order</h1>
        </div>
    </div>


    <div class="container">

        <div class="row">
          <div class="container">

              <label for="suppliers">Supplier:
              <input id="suppliers" list="suppliers_list">
              <datalist id="suppliers_list">

              <% suppliers.forEach(function(item) { %>

              <option id="supplier_choice" value=<%= item["supplier_name"]%>></option>

              <% }); %>

              </datalist>
              </label>
</div>
</div>
<div class="row">
  <div class="container">
<p>

</p>
  <label for="products">Product:
  <input id="products" list="products_list">
  <datalist id="products_list">
  </datalist>
  </label>
</div>

</div>
<div class="row">
  <div class="container"><label for="products">Quantity:
    <div class="input-group spinner">
      <input type="text" class="form-control" id="quantity" value="1">
      <div class="input-group-btn-vertical">
        <button class="btn btn-default" type="button"><i class="fa fa-caret-up"></i></button>
        <button class="btn btn-default" type="button"><i class="fa fa-caret-down"></i></button>
      </div>
    </div>
  </div>

<p>

</p>

</div>
<div class="row">
  <div class="container">



              <input type="button" onclick="add_to_order();" class="btn btn-info" value="Add to order">

            </div>

</div>
        <input type="hidden" id="last_price" >


<h1>Order summary</h1>
<form>
  <div class="container" id="summary">
  </form>

  </div>

<div>
  <div class="col">
  <h2 class="text-right">Total price</h2>
</div>
<div class="col">
    <h3 class="text-right" id="order_total"></h3>
</div>
  </div>
</div>

<script>

(function ($) {
  $('.spinner .btn:first-of-type').on('click', function() {
    $('.spinner input').val( parseInt($('.spinner input').val(), 10) + 1);
  });
  $('.spinner .btn:last-of-type').on('click', function() {
    $('.spinner input').val( parseInt($('.spinner input').val(), 10) - 1);
  });
})(jQuery);
</script>

        <script>
        document.getElementById("order_total").innerHTML = 0;

        <% suppliers.forEach(function(item) { %>
        <%= item["supplier_name"]%> = new Array([<% item["products"].forEach(function(thing) { %>
        "<%= thing["product_name"] %> : <%= thing["product_price"] %> " ,
        <% }); %>
        ]);
          <% }); %>

          <% suppliers.forEach(function(item) { %>
        <%= item["supplier_name"]%> = <%= item["supplier_name"]%>[0];
        <% }); %>


        $("#suppliers").bind('input', function () {
          populateSelect();
        });

        function clearBoxes(){
          document.getElementById("suppliers").value = "";
          document.getElementById("products").value = "";
        }

        function populateSelect(){
            cat=$('#suppliers').val();
            $('#products_list').html('');
               eval(cat).forEach(function(t) {
                    $('#products_list').append('<option>'+t+'</option>');
                });
            }

            function removeElement(elementId) {
                // Removes an element from the document

                document.getElementById("order_total").innerHTML = parseFloat($('#order_total').text()) - parseFloat($('#last_price').text()) ;

                var element = document.getElementById(elementId);
                element.parentNode.removeChild(element);


            }

            var fileId = 0; // used by the addFile() function to keep track of IDs

            function add_to_order() {
              // console.log($('#suppliers').val().length);
              if ($('#suppliers').val().length != 0)  {
              fileId++; // increment fileId to get a unique ID for the new element

              // /var supplier_order = $('#suppliers').val();
                document.getElementById('summary').innerHTML +=

                '<div id='+fileId+'><div class="form-group"><label for="supplier_name">Supplier name:</label><input type="text" readonly class="form-control" id="supplier_name" value='+
                $('#suppliers').val()+
                 '></div><div class="form-group"><label for="product_name">Product name:</label><input type="text" readonly class="form-control" id="product_name" value='+
                $('#products').val()+
                '></div><div class="form-group"><label for="product_quantity">Quantity:</label><input type="text" readonly class="form-control" id="product_quantity" value='+
               $('#quantity').val()+
               '></div><a href="" onclick="javascript:removeElement('+fileId + '); return false;">Remove</a></div>';
               var priceToAdd = parseFloat($('#quantity').val())*(parseFloat($('#products').val().split(":")[1]));
                document.getElementById("order_total").innerHTML = parseFloat($('#order_total').text()) + priceToAdd;
                document.getElementById("last_price").innerHTML = priceToAdd;

                clearBoxes();
            }}

        </script>
        </body>
